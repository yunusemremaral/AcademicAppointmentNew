
@{
    ViewData["Title"] = "Bölüm Listesi";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}


@model IEnumerable<DepartmentWithSchoolDto>

<div class="container mt-4">
    <h1 class="mb-4">Bölüm Yönetimi</h1>

    <!-- Filtreleme Alanı -->
    <form asp-action="Index" method="get" class="mb-4">
        <div class="row">
            <div class="col-md-4">
                <select name="schoolName" asp-items="@ViewBag.SchoolNames" class="form-select">
                    <option value="">Tüm Okullar</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary">Filtrele</button>
            </div>
        </div>
    </form>

    <!-- Tablo -->
    <!-- Tablo -->
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Bölüm Adı</th>
                    <th>Okul Adı</th>
                    <th>İşlemler</th> <!-- Yeni Sütun -->
                </tr>
            </thead>
            <tbody>
                @foreach (var department in Model)
                {
                    <tr>
                        <td>@department.Id</td>
                        <td>@department.DepartmentName</td>
                        <td>@department.SchoolName</td>
                        <td>
                            <div class="btn-group" role="group">
                                <!-- Dersleri Göster Butonu -->
                                <a class="btn btn-sm btn-info"
                                   href="#"
                                   title="Dersleri Göster"
                                   onclick="showCourses(@department.Id)">
                                    <i class="fas fa-book"></i>
                                </a>

                                <!-- Güncelle Butonu -->
                                <a class="btn btn-sm btn-warning"
                                   asp-action="Edit"
                                   asp-route-id="@department.Id"
                                   title="Güncelle">
                                    <i class="fas fa-edit"></i>
                                </a>

                                <!-- Sil Butonu -->
                                <form asp-action="Delete" method="post" class="d-inline">
                                    <input type="hidden" name="id" value="@department.Id" />
                                    <button type="button"
                                            class="btn btn-sm btn-danger"
                                            title="Sil"
                                            onclick="confirmDelete(this)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Alt Tarafa Bölüm Ekle Butonu -->
    <div class="mt-4">
        <a class="btn btn-success"
           asp-action="Create"
           asp-route-schoolId="@ViewBag.SelectedSchoolId">
            <i class="fas fa-plus"></i> Yeni Bölüm Ekle
        </a>
    </div>
</div>

@section Scripts {
    <script>
        // Silme Onayı
        function confirmDelete(btn) {
            if(confirm('Bu bölümü silmek istediğinize emin misiniz?')) {
                btn.closest('form').submit();
            }
        }

        // Dersleri Göster (Placeholder)
        function showCourses(departmentId) {
            alert('Dersler gösterilecek - Department ID: ' + departmentId);
            // Buraya AJAX çağrısı veya yeni sayfa implementasyonu gelecek
        }

        // Dropdown değiştiğinde otomatik filtrele
        document.querySelector('select[name="schoolName"]').addEventListener('change', function() {
            this.form.submit();
        });
    </script>
}
